# Оптимизированная геолокация и новости

## Обзор
Компонент `NewsList` получает геолокацию пользователя и загружает персонализированные новости через OpenAI API на языке пользователя.

## Функциональность

### 1. Получение геолокации
- Автоматическое получение координат при загрузке
- Преобразование координат в читаемый адрес
- Кэширование результата (не перезагружается при повторном открытии)

### 2. Персонализированные новости
- Загрузка новостей на языке пользователя из профиля
- Фокус на иммиграционных новостях для конкретной национальности
- Новости для конкретного региона (на основе геолокации)
- Каждая новость содержит рабочую ссылку

### 3. Интерфейс
- Индикаторы загрузки для геолокации и новостей
- Отображение текущего адреса и координат
- Обработка ошибок доступа к геолокации
- Кликабельные новости с переходом по ссылкам

## Структура новости

```typescript
interface NewsItem {
  title: string;        // Заголовок новости
  description: string;  // Краткое описание
  source: string;      // Источник новости
  time: string;        // Время публикации
  link: string;        // Рабочая ссылка на новость
}
```

## Логика работы

1. **Загрузка компонента**: 
   - Автоматически запрашивается геолокация
   - Показывается индикатор загрузки

2. **Получение локации**:
   - Запрос разрешений у пользователя
   - Получение координат и адреса
   - Отображение информации о местоположении

3. **Загрузка новостей**:
   - Проверка наличия: геолокации, национальности, языка
   - Отправка запроса к OpenAI API
   - Парсинг JSON ответа
   - Отображение новостей

## Требования

- Профиль пользователя должен содержать:
  - `nationality` - национальность для фильтрации новостей
  - `language` - язык для ответа AI
- Доступ к геолокации
- Рабочий API ключ OpenAI
- Интернет соединение

## Обработка ошибок

- **Нет доступа к геолокации**: Показывается сообщение об ошибке
- **Ошибка парсинга новостей**: Логируется в консоль, новости не отображаются  
- **Нет новостей**: Показывается сообщение "Новости не найдены"

## Оптимизация

- Убраны все fallback варианты
- Минимальная логика обработки данных
- Загрузка только реальных данных от AI
- Кэширование геолокации для избежания повторных запросов

## Использование геолокации в приложении

## Обзор
В компонент `NewsList` добавлена функциональность получения геолокации пользователя для персонализации новостей.

## Что было добавлено

### 1. Хук useLocation (`client/hooks/useLocation.ts`)
Переиспользуемый хук для работы с геолокацией:
- Автоматическое получение координат при монтировании
- Преобразование координат в читаемый адрес
- Обработка ошибок и состояний загрузки
- Запрос разрешений у пользователя

### 2. Обновленный компонент NewsList
- Отображение текущего местоположения пользователя
- Индикатор загрузки при получении локации
- Обработка ошибок доступа к геолокации
- Показ координат и адреса

### 3. Конфигурация разрешений
В файле `app.json` добавлены необходимые разрешения:
- iOS: `NSLocationWhenInUseUsageDescription`
- Android: `ACCESS_FINE_LOCATION`, `ACCESS_COARSE_LOCATION`

## Использование в других компонентах

```typescript
import { useLocation } from '@/hooks/useLocation';

const MyComponent = () => {
  const { location, address, loading, error, getCoordinates } = useLocation();
  
  if (loading) {
    return <Text>Получение местоположения...</Text>;
  }
  
  if (error) {
    return <Text>Ошибка: {error}</Text>;
  }
  
  const coords = getCoordinates();
  
  return (
    <View>
      <Text>Адрес: {address}</Text>
      {coords && (
        <Text>
          Координаты: {coords.latitude}, {coords.longitude}
        </Text>
      )}
    </View>
  );
};
```

## API хука useLocation

### Возвращаемые значения:
- `location`: объект с полной информацией о местоположении
- `address`: читаемый адрес (город, регион, страна)
- `loading`: состояние загрузки
- `error`: сообщение об ошибке
- `getCurrentLocation()`: функция для повторного получения локации
- `getCoordinates()`: получение координат в удобном формате
- `getAddressString()`: получение адреса в виде строки

### Примеры использования данных локации:
1. Фильтрация новостей по региону
2. Отображение погоды для текущего местоположения
3. Поиск ближайших событий или заведений
4. Персонализация контента

## Тестирование
1. В симуляторе iOS: Features > Location > Apple
2. В эмуляторе Android: Extended Controls > Location
3. На реальном устройстве: разрешить доступ к геолокации

## Безопасность
- Приложение запрашивает минимальные необходимые разрешения
- Используется точность "Balanced" для оптимизации батареи
- Все ошибки обрабатываются gracefully 